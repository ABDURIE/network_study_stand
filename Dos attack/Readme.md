# Демонстрация балансировки трафика с помощью Nginx

Этот проект демонстрирует использование Nginx для балансировки трафика между тремя Apache-серверами. Каждый сервер Apache выводит простой HTML-файл, что позволяет визуально наблюдать распределение нагрузки при каждом запросе.

## Содержание

- [Описание проекта](#описание-проекта)
- [Требования](#требования)
- [Запуск проекта](#запуск-проекта)
- [Проверка работы](#проверка-работы)
- [Остановка и удаление контейнеров](#остановка-и-удаление-контейнеров)
- [Полезные ссылки](#полезные-ссылки)

## Описание проекта

- **Nginx**: Используется для балансировки трафика на три бэкенд-сервера Apache.
- **Apache-серверы**: Три контейнера с Apache, каждый из которых обслуживает простой HTML файл.
- **Docker Compose**: Управляет всеми сервисами, поднимая их с помощью одного файла конфигурации.

### Методы балансировки в Nginx:
- **Round Robin** — Nginx направляет запросы по очереди на каждый сервер Apache. 
По умолчанию мы будем использовать именно его
- **Least connected load balancing** - 
- **Session persistence** - 

Подробнее про все методы балансировки [можно прочесть здесь](https://nginx.org/en/docs/http/load_balancing.html)

## Требования

Перед запуском проекта убедитесь, что на вашем компьютере установлены следующие инструменты:
- **Docker**: [Установка Docker](https://docs.docker.com/get-docker/)
- **Docker Compose**: [Установка Docker Compose](https://docs.docker.com/compose/install/)

## Запуск проекта

1. Склонируйте репозиторий с проектом:

```bash
git clone <ссылка на репозиторий>
cd <название директории>
```
2. Запустите контейнеры с помощью Docker Compose:
```bash
docker-compose up -d
```
3. Docker Compose запустит:
- Один контейнер с Nginx.
- Три контейнера с Apache-серверами.

## Проверка работы

1. Откройте браузер и перейдите по адресу [http://localhost:8080](http://localhost:8080).
2. При каждом обновлении страницы вы будете видеть разные HTML страницы с надписями:
   - **Backend 1**
   - **Backend 2**
   - **Backend 3**

Эти страницы показывают, на какой сервер Apache был отправлен ваш запрос. Балансировка осуществляется по принципу Round Robin — каждый запрос направляется на следующий сервер в группе.

3. Вы можете проверить работу балансировки с помощью командной строки. Введите следующую команду несколько раз:

```bash
curl http://<IP addr vm>>:8080
```

При каждом выполнении команды будет выведена HTML-страница от одного из Apache-серверов. Пример вывода:

```bash
<html>
<body>
    <h1>Backend 1</h1>
</body>
</html>
```
Повторяя команду несколько раз, вы увидите чередование между серверами, так как Nginx распределяет запросы по схеме Round Robin. Например, следующий запрос может вернуть:

```bash
<html>
<body>
    <h1>Backend 2</h1>
</body>
</html>
```
И так далее. Таким образом, вы можете убедиться, что балансировка трафика между серверами работает корректно.

4. Проверка с помощью watch
Чтобы упростить процесс проверки, вы можете использовать утилиту watch, которая будет автоматически выполнять curl через регулярные интервалы времени. Например:

```bash
watch -n 1 curl http://<IP addr vm>>:8080
```
Эта команда будет отправлять запросы к Nginx каждые 1 секунду и отображать результаты в терминале. Вы сможете наблюдать чередование ответов от разных Apache-серверов в режиме реального времени.

## Отладка
Если вам необходимо отладить работу системы или выяснить, почему контейнеры не работают так, как ожидалось, можно воспользоваться следующими командами:

Проверка статуса контейнеров - выполните команду для просмотра состояния всех контейнеров:
```bash
docker compose ps
```
Эта команда покажет список запущенных контейнеров и их текущее состояние.

Просмотр логов Nginx: для анализа логов Nginx выполните:
```bash
docker logs -fn 1 nginx-load-balancer
```
Просмотр логов Apache-серверов: для каждого Apache-сервера:
```bash
docker logs -fn 1 backend1
docker logs -fn 1 backend2
docker logs -fn 1 backend3
```

## Остановка и удаление контейнеров
Когда тестирование завершено, можно остановить и удалить все запущенные контейнеры:

Остановка всех контейнеров: чтобы остановить контейнеры, выполните:

```bash
docker compose down
```
### Полное удаление контейнеров и связанных данных:

Если вы хотите не только остановить контейнеры, но и удалить все тома данных, выполните:
```bash
docker compose down -v
```
Это удалит все данные, созданные контейнерами (например, логи, кэш и временные файлы).

## Полезные ссылки

Для более глубокого изучения инструментов, используемых в проекте, ознакомьтесь с официальной документацией:

- [Документация Nginx](https://nginx.org/ru/docs/) — Официальная документация по Nginx, включая настройки прокси и балансировки нагрузки.
- [Документация Apache](https://httpd.apache.org/docs/) — Руководство по установке и настройке Apache HTTP Server, используемого в качестве бэкендов.
- [Документация Docker](https://docs.docker.com/) — Полное руководство по Docker, включающее инструкции по установке, основным командам и использованию контейнеров.
- [Документация Docker Compose](https://docs.docker.com/compose/) — Документация по Docker Compose для управления многоконтейнерными приложениями и оркестрацией сервисов.
- [Docker Hub — Nginx](https://hub.docker.com/_/nginx) — Страница с официальным образом Nginx на Docker Hub.
- [Docker Hub — Apache (httpd)](https://hub.docker.com/_/httpd) — Страница с официальным образом Apache HTTP Server на Docker Hub.

Эти ресурсы помогут вам лучше понять, как работают компоненты данного проекта, и освоить их для дальнейшего использования.

---

Проект готов к использованию. Удачи в изучении балансировки трафика с Nginx и Docker!
